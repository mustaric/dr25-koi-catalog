\subsection{Simulated TCEs}
\label{s:simulated}
In order to measure the performance of the Robovetter and the \Kepler\ Pipeline, we created simulated transits and simulated false alarms \footnote{Simulated false positives were also created to simulate eclipsing binaries. See \citet{Coughlin2017a} for more information.}. The simulated transits are created by injecting transit signals onto the pixels of our original data. The simulated false alarms were created in two separate ways: by inverting the light curves, and by scrambling the sequence of cadences in the time series. The TCEs that resulted from these simulated data are available at the Exoplanet Archive on the Kepler simulated data page.\footnote{\url{https://exoplanetarchive.ipac.caltech.edu/docs/KeplerSimulated.html}}

%For both the \invtce{s} and the \scrtce{s} we needed to remove true astrophysical events, as explained in \S\ref{s:clean} below, in order to match the false alarms found in the \opstce data set.
%JLC1: I think the final sentence is confusing extra detail in the intro paragraph to this section. % SEM Agreed.

\subsubsection{True Transits -- Injection}
\label{injectsec}

We empirically measure the completeness of the \Kepler\ Pipeline and the subsequent vetting by injecting a suite of simulated transiting planet signals into the calibrated pixel data and observing their recovery, as was done for previous versions of the \Kepler{} Pipeline \citep{Christiansen2013a,Christiansen2015,Christiansen2016}. The full analysis of the DR25 injections are described in detail in \citet{Christiansen2017}. In order to understand the completeness of the Robovetter, we use the on-target injections (Group 1 in \citet{Christiansen2017}); we briefly describe their properties here. For each of 146,294 targets, we generate a model transit signal using the \citet{Mandel2002} formulation, with parameters drawn from the following uniform distributions: orbital periods from 0.5--500 days (0.5--100 days for M dwarf targets), planet radii from 0.25-7 \re{} (0.25-4 \re{} for M dwarf targets), and impact parameters from 0--1. After some re-distribution in planet radius to ensure sufficient coverage where the \Kepler{}Pipeline is fully incomplete (0\% recovery) to fully complete (100\% recovery), 50\% of the injections have planet radii below 2\,\re{} and 90\% below 40\,\re{}. The signals are injected into the calibrated pixels, and then processed through the remaining components of the \Kepler{} Pipeline in an identical fashion to the original data. Any detected signals are subjected to the same scrutiny by the Pipeline and the Robovetter as the original data. By measuring the fraction of injections that were successfully recovered by the Pipeline and called a planet candidate by the Robovetter with any given set of parameters (e.g., orbital period and planet radius), we can then correct the number of candidates found with those parameters to the number that are truly present in the data. Because more long-period, low signal-to-noise transits are either not recovered or not vetted appropriately, more of these hard-to-find planets were injected to ensure that we could measure the Pipeline and Robovetter completeness.  In this paper we use the set of true candidates recovered by the \Kepler{} Pipeline, the \injtce{s} shown in Figure~\ref{f:simtces}, to measure the performance of Robovetter. The measurement of the performance is limited to those types of transit recovered. The injections produce mostly long-period TCEs. 

{\color{blue}It is worth noting that these injection do not completely emulate all astrophysical variations produced by a planet transiting a star.  For instance, the injected model includes limb-darkening, but not the occultation of stellar pulsations or granulation, which has been shown to cause an small, but non-negligible, error source on measured transit depth \citep{Chiavassa2017} for high signal-to-noise transits.  For studying the performance of the Robovetter, this could impact the completeness measurements of high MES transiting planets. }


\subsubsection{False Alarms -- Inverted and Scrambled} 

To create realistic false alarms which have noise properties similar to our \opstce{s}, we inverted the light curves (i.e. multiplied the normalized, mean-zeroed flux values by negative one) before searching for transit signals. Because the pipeline is only looking for transit-like (negative) dips in the light curve, the true exoplanet transits should no longer be found. However, instrumental noise, quasi-sinusoidal over-contact binaries, and stellar variability can still align to create detections. This approach assumes that the sources of false alarms are symmetric under flux inversion, which is not entirely true. For example, stellar oscillations and star spots are not sine-waves and SPSDs will not appear the same under inversion. However, the rolling band noise that is significant on many of Kepler's channels is mostly symmetric.  The period distribution of these \invtce{s} is shown in Figure~\ref{f:simtces}. The distribution qualitatively emulates those seen in the \opstce{s}; however there are only $\sim$60\% as many.  This is because the population does not include the exoplanets nor the eclipsing binaries; but it is also because many of the sources of false alarms are not symmetric under inversion.  The one-year spike is clearly seen, but is not as large as we might expect, likely because the broad long-period hump present in the DR25 \opstce{} distribution is missing from the \invtce{} distribution. We explore the similarity of the \invtce{s} to \opstce{s} in more detail in \S\ref{s:simularity}.

Another method to create false alarms is to scramble the order of the data. The requirement is to scramble the data enough to lose the coherency of the binary stars and exoplanet transits, but to keep the coherency of the instrumental and stellar noise that plagues the \Kepler\ data set. Our final solution was to scramble the data in coherent chunks of one year. The fourth year of data (Q13--Q16) was moved to the start of the light curve, followed by the third year (Q9--Q12), the second (Q5--Q8), and the first (Q1--Q4). Q17 remained at the end. Within each year, the order of the data did not change. Notice that in this configuration each quarter remains in the correct \Kepler\ season preserving the yearly artifacts produced by the spacecraft.


\begin{figure*}[htbp]
 \begin{center}
  \includegraphics[width=0.88\linewidth]{fig-simulTcePeriods.png}
  \caption{Histogram of the log$_{10}$(period) in days of the \invtce{s} (top, red), the \scrtce{s} (middle, green) and \injtce{s} (bottom, blue). The DR25 \opstce{s} are shown for comparison on the top two figures in black.  At shorter periods ($< 30$\,days), the difference between the simulated false alarm sets and the observed data represents the number of transit-like KOIs, at longer periods we primarily expect false alarms.  Notice that the \invtce{s} do a better job of reproducing the one-year spike, but the \scrtce{s} better reproduce the long-period hump better. Because the \injtce{s} are dominated by long-period events (note, significantly more long-period events were injected), we are better able to measure the Robovetter completeness for long-period planets than short-period planets.}
  \label{f:simtces} 
 \end{center}
 \end{figure*}



\subsubsection{Cleaning Inversion and Scrambling}
\label{s:clean}
As will be described in \S\ref{s:relcalc}, we want to use the \invtce\ and \scrtce\ sets to measure the reliability of the DR25 catalog against instrumental and stellar noise. In order to do that well, we need to remove signals found in these sets that are not typical of those in our \opstce\ set. For inversion, there are astrophysical events that look similar to an inverted eclipse, for example the self-lensing binary star, K03278.01 \citep{Kruse2014}, and Heartbeat binaries \citep{Thompson2012}. With the assistance of published systems and early runs of the Robovetter, we identified any \invtce\ that could be one of these types of astrophysical events; 54 systems were identified in total. Also, the shoulders of inverted eclipsing binary stars and high signal-to-noise KOIs are found by the pipeline but are not the type of false alarm we were trying to reproduce, since they have no corresponding false alarm in the original, un-inverted light curves. We remove any \invtce{s} that were found on stars that had 1) one of the identified astrophysical events, 2) a detached eclipsing binary listed in \citet{Kirk2016} with morphology values larger than 0.6, or 3) a known KOI.  After cleaning, we are left with \ninvtces\ \invtce{s}; their distribution is plotted in the top of Figure~\ref{f:simtces}.

For the scrambled data, we do not have to worry about the astrophysical events that emulate inverted transits, but we do have to worry about triggering on true transits that have been rearranged to line up with noise. For this reason we remove from the \scrtce\ population all that were found on a star with a known eclipsing binary \citep{Kirk2016}, or on a previously identified KOI.  The result is \nscrtces\ \scrtce s; their distribution is plotted in the middle panel of Figure~\ref{f:simtces}. 
{\color{blue}This will not remove all possible sources of astrophysical transits. Systems with only two transits (which would not be made into KOIs), or systems with single transits from several orbiting bodies would not be identified in this way. For example, KIC~3542116 was identified by \citet{Rappaport2017} as a star with possible exocomets, and it is a \scrtce\ dispositioned as an FP. Or, astrophysical events similar to the mysterious dips on KIC~8462852 ("Boyajian's Star") \citep{Boyajian2016} could create \scrtce{s} (the \scrtce{s} does not include KIC~8462852.) But we expect the effect of not removing these unusual events to be negligible on our reliability measurements.
}

After cleaning the \invtce{s} and \scrtce{s} of the eclipsing binary and KOI systems, the number of \scrtce{s} at periods longer than 200\,d closely matches the size and shape of the distribution for the \opstce s, except for the one-year spike. The one-year spike is well represented by the \invtce{s}.  Combining the two sets appears to give a good handle on the type and relative frequency of false alarms present in the DR25 \opstce\ population. Tables\,\ref{t:invclean} and \ref{t:scrclean} lists those \invtce{s} and \scrtce{s} that we used when calculating the false alarm effectiveness and false alarm reliability of the planet candidates.

\input{Table-invclean.tex}
\input{Table-scrclean.tex}

